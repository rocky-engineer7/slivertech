/*
  # ワーク課題5-2-5
  exam_resultsテーブルの全カラムに加え、各レコードの教科の平均点を表示するカラムを加えたデータを取得するSQLを以下に書いてください。

  (取得結果イメージ)
  +------------+---------+-------+-----------------------+
  | student_id | subject | score | subject_average_score |
  +------------+---------+-------+-----------------------+
  | 0000000001 |   国語  |   30  |           50          |
  +------------+---------+-------+-----------------------+
  | 0000000001 |   英語  |   30  |           26          |
  +------------+---------+-------+-----------------------+
  | 0000000002 |   国語  |   70  |           50          |
  +------------+---------+-------+-----------------------+
  | 0000000002 |   数学  |   80  |           80          |
  +------------+---------+-------+-----------------------+
  | 0000000003 |   理科  |   92  |          63.5         |
  +------------+---------+-------+-----------------------+
  | 0000000004 |   理科  |   35  |          63.5         |
  +------------+---------+-------+-----------------------+
  | 0000000004 |   社会  |   90  |           90          |
  +------------+---------+-------+-----------------------+
  | 0000000004 |   英語  |   22  |           26          |
  +------------+---------+-------+-----------------------+
*/

SELECT e.student_id, e.subject, e.score, avgs.subject_average_score
FROM exam_results AS e
JOIN (
  SELECT subject, AVG(score) AS subject_average_score
  FROM exam_results
  GROUP BY subject
) AS avgs
ON e.subject = avgs.subject
;
